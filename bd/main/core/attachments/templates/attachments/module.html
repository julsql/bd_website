{% extends 'main/base.html' %}
{% load static %}

{% block body %}

<div class="col-12">

    <section>
        <header>
            <h2>Sommaire</h2>
            <h3><a href="#dedicaces">Dédicaces ({{ signed_copy_sum }})</a></h3>
            <h3><a href="#exlibris">Ex Libris ({{ exlibris_sum }})</a></h3>
        </header>
    </section>

<!-- Main Content -->
    <section id="dedicaces">
        <div class="title">
            <header>
                <h2>Les dédicaces</h2>
                <h3>Toutes les dédicaces</h3>
            </header>

            <div id="hideDedicace">Afficher</div>
        </div>

        <div id="all_dedicaces">
            <div id="dedicace-pagination">
                <div id="dedicace-first-page" class="pagination">Début</div>
                <div id="dedicace-prev-page" class="pagination">Précédent</div>
                <span id="dedicace-current-page"></span>
                <div id="dedicace-next-page" class="pagination">Suivant</div>
                <div id="dedicace-last-page" class="pagination">Fin</div>
            </div>

            {% for bd in signed_copies %}

                <section id="dedicaces_{{ bd.isbn }}" class="pagination-item-dedicace sub-section">
                    <header>
                        <h2>
                            <a href="{% url 'pagebd' bd.isbn %}">
                                {% if bd.number and bd.number != "" %}
                                    Tome {{ bd.number }}
                                    {% if bd.album and bd.album != "" %}
                                        :
                                    {% endif %}
                                {% endif %}

                                {% if bd.album and bd.album != "" %}
                                    {{ bd.album }}
                                {% else %}
                                    {{ bd.isbn }}
                                {% endif %}
                            </a>
                        </h2>
                        {% if bd.series and bd.series != "" %}
                            <h2>{{ bd.series }}</h2>
                        {% endif %}

                        <p>{{ bd.signed_copy }} dédicace{% if bd.signed_copy > 1 %}s{% endif %}</p>
                    </header>

                    <div class="image_group">
                    {% for i in bd.signes_copy_range %}
                            <img src="/media/main/images/dedicaces/{{ bd.isbn }}/{{ i }}.jpeg"
                                 alt="{{ bd.isbn }}"
                                 data-full="/media/main/images/dedicaces/{{ bd.isbn }}/{{ i }}.jpeg"
                                 data-title="<h2>{{ bd.series }}</h2>"
                                 data-info="<p>{{ bd.album }}</p>"
                                 class="photo_dedicace"
                            />
                        {% endfor %}
                    </div>
                </section>
            {% endfor %}
        </div>
    </section>

    <section id="exlibris">
        <div class="title">
            <header>
                <h2>Les Ex Libris</h2>
                <h3>Tous les ex libris</h3>
            </header>
            <div id="hideExlibris">Afficher</div>
        </div>

    <div id="all_exlibris">
        <div id="exlibris-pagination">
            <div id="exlibris-first-page" class="pagination">Début</div>
            <div id="exlibris-prev-page" class="pagination">Précédent</div>
            <span id="exlibris-current-page"></span>
            <div id="exlibris-next-page" class="pagination">Suivant</div>
            <div id="exlibris-last-page" class="pagination">Fin</div>
        </div>
        {% for bd in exlibris %}

            <section id="exlibris_{{ bd.isbn }}" class="pagination-item-exlibris sub-section">
                <header>
                    <h2>
                        <a href="{% url 'pagebd' bd.isbn %}">
                            {% if bd.number and bd.number != "" %}
                                Tome {{ bd.number }}
                                {% if bd.album and bd.album != "" %}
                                    :
                                {% endif %}
                            {% endif %}

                            {% if bd.album and bd.album != "" %}
                                {{ bd.album }}
                            {% else %}
                                {{ bd.isbn }}
                            {% endif %}
                        </a>
                    </h2>
                    {% if bd.series and bd.series != "" %}
                        <h2>{{ bd.series }}</h2>
                    {% endif %}

                    <p>{{bd.ex_libris}} ex libris</p>
                </header>
                <div class="image_group">
                    {% for i in bd.ex_libris_range %}
                        <img src="/media/main/images/exlibris/{{ bd.isbn }}/{{ i }}.jpeg"
                             alt="{{ bd.isbn }}"
                             data-full="/media/main/images/exlibris/{{ bd.isbn }}/{{ i }}.jpeg"
                             data-title="<h2>{{ bd.series }}</h2>"
                             data-info="<p>{{ bd.album }}</p>"
                             class="photo_exlibris"
                        />
                    {% endfor %}
                </div>
            </section>
        {% endfor %}
    </div>
    </section>


</div>

    <div class="popup" id="popup">
        <div class="popup-content">
            <div id="image-title"></div>
            <div id="image-info"></div>

            <img id="popup-img" src="" alt="Couverture"/>
            <button class="popup_button close" id="close-popup">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M18 6L12 12L6 6L4.59 7.41L10.59 13.41L4.59 19.41L6 21L12 15L18 21L19.41 19.41L13.41 13.41L19.41 7.41L18 6Z" />
                </svg>
            </button>
            <button class="popup_button prev" id="prev-image">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>
            <button class="popup_button next" id="next-image">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
                </svg>
            </button>
        </div>
    </div>
{% endblock %}

{% block javascript %}
    <script src="{% static 'main/scripts/image_popup.js' %}"></script>
    <script>
        const allDedicaces = document.getElementById("all_dedicaces");
        const dedicaces = document.getElementById("hideDedicace");
        let dedicaceVisible = false;
        dedicaces.addEventListener("click", function () {
                if (dedicaceVisible) {
                    allDedicaces.style.visibility = "hidden";
                    allDedicaces.style.display = "none";
                    dedicaces.textContent = "Afficher";
                } else {
                    allDedicaces.style.visibility = "visible";
                    allDedicaces.style.display = "block";
                    dedicaces.textContent = "Masquer";
                }
                dedicaceVisible = !dedicaceVisible;
        });

        const allExlibris = document.getElementById("all_exlibris");
        const exlibris = document.getElementById("hideExlibris");
        let exlibrisVisible = false;
        exlibris.addEventListener("click", function () {
            if (exlibrisVisible) {
                allExlibris.style.visibility = "hidden";
                allExlibris.style.display = "none";
                exlibris.textContent = "Afficher";
            } else {
                allExlibris.style.visibility = "visible";
                allExlibris.style.display = "block";
                exlibris.textContent = "Masquer";
            }
            exlibrisVisible = !exlibrisVisible;
        });
    </script>
     <script>
            const firstPage = document.getElementById("dedicace-first-page");
            const prevPage = document.getElementById("dedicace-prev-page");
            const currentPage = document.getElementById("dedicace-current-page");
            const nextPage = document.getElementById("dedicace-next-page");
            const lastPage = document.getElementById("dedicace-last-page");

            firstPage.addEventListener("selectstart", function (e) {e.preventDefault();});
            prevPage.addEventListener("selectstart", function (e) {e.preventDefault();});
            currentPage.addEventListener("selectstart", function (e) {e.preventDefault();});
            nextPage.addEventListener("selectstart", function (e) {e.preventDefault();});
            lastPage.addEventListener("selectstart", function (e) {e.preventDefault();});

            const paginationItems = document.querySelectorAll(".pagination-item-dedicace");
            const itemsPerPage = 20;
            const nbPage = Math.ceil(paginationItems.length / itemsPerPage);
            let currentPageInt = 1;

            function displayPage(pageNumber) {
                const startIndex = (pageNumber - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;

                paginationItems.forEach((item, index) => {
                    if (index >= startIndex && index < endIndex) {
                        item.style.visibility = "visible";
                        item.style.display = "block";
                    } else {
                        item.style.visibility = "hidden";
                        item.style.display = "none";
                    }
                });
                currentPage.textContent = pageNumber + "/" + nbPage
                if (currentPageInt === 1) {
                    firstPage.style.visibility = "hidden"
                }
                else {
                    firstPage.style.visibility = "visible"
                }
                if (currentPageInt === nbPage) {
                    lastPage.style.visibility = "hidden"
                }
                else {
                    lastPage.style.visibility = "visible"
                }

            }
            prevPage.addEventListener("click", function () {
                if (currentPageInt > 1) {
                    currentPageInt--;
                    displayPage(currentPageInt);
                }
            });

            nextPage.addEventListener("click", function () {

                if (currentPageInt < nbPage) {
                    currentPageInt++;
                    displayPage(currentPageInt);
                }
            });

            firstPage.addEventListener("click", function () {

                if (currentPageInt > 1) {
                    currentPageInt = 1;
                    displayPage(currentPageInt);
                }
            });

            lastPage.addEventListener("click", function () {

                if (currentPageInt < nbPage) {
                    currentPageInt = nbPage;
                    displayPage(currentPageInt);
                }
            });

            displayPage(currentPageInt);

        </script>

    <script>
        const firstPageExlibris = document.getElementById("exlibris-first-page");
        const prevPageExlibris = document.getElementById("exlibris-prev-page");
        const currentPageExlibris = document.getElementById("exlibris-current-page");
        const nextPageExlibris = document.getElementById("exlibris-next-page");
        const lastPageExlibris = document.getElementById("exlibris-last-page");

        firstPageExlibris.addEventListener("selectstart", function (e) {e.preventDefault();});
        prevPageExlibris.addEventListener("selectstart", function (e) {e.preventDefault();});
        currentPageExlibris.addEventListener("selectstart", function (e) {e.preventDefault();});
        nextPageExlibris.addEventListener("selectstart", function (e) {e.preventDefault();});
        lastPageExlibris.addEventListener("selectstart", function (e) {e.preventDefault();});

        const paginationItemsExlibris = document.querySelectorAll(".pagination-item-exlibris");
        const nbPageExlibris = Math.ceil(paginationItemsExlibris.length / itemsPerPage);
        let currentPageIntExlibris = 1;

        function displayPage(pageNumber) {
            const startIndex = (pageNumber - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;

            paginationItemsExlibris.forEach((item, index) => {
                if (index >= startIndex && index < endIndex) {
                    item.style.visibility = "visible";
                    item.style.display = "block";
                } else {
                    item.style.visibility = "hidden";
                    item.style.display = "none";
                }
            });
            currentPageExlibris.textContent = pageNumber + "/" + nbPageExlibris
            if (currentPageIntExlibris === 1) {
                firstPageExlibris.style.visibility = "hidden"
            }
            else {
                firstPageExlibris.style.visibility = "visible"
            }
            if (currentPageIntExlibris === nbPageExlibris) {
                lastPageExlibris.style.visibility = "hidden"
            }
            else {
                lastPageExlibris.style.visibility = "visible"
            }

        }
        prevPageExlibris.addEventListener("click", function () {
            if (currentPageIntExlibris > 1) {
                currentPageIntExlibris--;
                displayPage(currentPageIntExlibris);
            }
        });

        nextPageExlibris.addEventListener("click", function () {

            if (currentPageIntExlibris < nbPageExlibris) {
                currentPageIntExlibris++;
                displayPage(currentPageIntExlibris);
            }
        });

        firstPageExlibris.addEventListener("click", function () {

            if (currentPageIntExlibris > 1) {
                currentPageIntExlibris = 1;
                displayPage(currentPageIntExlibris);
            }
        });

        lastPageExlibris.addEventListener("click", function () {

            if (currentPageIntExlibris < nbPageExlibris) {
                currentPageIntExlibris = nbPageExlibris;
                displayPage(currentPageIntExlibris);
            }
        });

        displayPage(currentPageIntExlibris);

    </script>

{% endblock %}